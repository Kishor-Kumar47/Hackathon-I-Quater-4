# Data Model: Agent & Retrieval Integration

**Version**: 1.0
**Date**: 2025-12-17

This document defines the data structures used in the Agent-Based RAG Chatbot, based on the feature specification and research findings.

---

### 1. AgentQueryRequest

Represents an incoming API request from the user, supporting both full-book and user-provided context queries.

-   **Source**: FastAPI endpoint payload.
-   **Schema**:
    ```python
    from pydantic import BaseModel, Field
    from typing import Optional

    class AgentQueryRequest(BaseModel):
        query: str = Field(..., description="The user's question or query.")
        context: Optional[str] = Field(None, description="Optional: User-provided text context for the query. If provided, the agent uses this instead of retrieving from the vector database.")
    ```
-   **Fields**:
    -   `query`: The natural language question or query from the user.
    -   `context`: An optional string containing user-provided text. Its presence dictates the agent's operational mode (user-provided vs. retrieval).

---

### 2. AgentResponse

Represents the agent's generated response to a user query.

-   **Source**: FastAPI endpoint response.
-   **Schema**:
    ```python
    from pydantic import BaseModel, Field

    class AgentResponse(BaseModel):
        answer: str = Field(..., description="The agent's answer to the query, grounded in the provided context.")
    ```
-   **Fields**:
    -   `answer`: The concise, accurate answer generated by the agent.

---

### 3. RetrievalToolInput

Represents the input structure for the Qdrant retrieval tool used by the agent framework.

-   **Source**: Internal agent tool invocation.
-   **Schema**:
    ```python
    from pydantic import BaseModel, Field

    class RetrievalToolInput(BaseModel):
        query: str = Field(..., description="The query string used for retrieval from the vector database.")
        k: int = Field(5, description="The number of top relevant chunks to retrieve.")
    ```
-   **Fields**:
    -   `query`: The search query to be used against the vector database.
    -   `k`: The number of top-k relevant documents to retrieve.

---

### 4. RetrievedDocument

Represents a single document (or chunk) retrieved from the vector database.

-   **Source**: Qdrant search result payload.
-   **Schema**:
    ```python
    from pydantic import BaseModel, Field
    from typing import Dict, Any

    class RetrievedDocument(BaseModel):
        id: str = Field(..., description="Unique identifier of the document chunk.")
        content: str = Field(..., description="The text content of the document chunk.")
        score: float = Field(..., description="Similarity score from the vector database.")
        metadata: Dict[str, Any] = Field({}, description="Additional metadata associated with the chunk.")
    ```
-   **Fields**:
    -   `id`: The unique identifier of the document chunk.
    -   `content`: The text content of the chunk.
    -   `score`: The similarity score from the vector database.
    -   `metadata`: Any other relevant metadata (e.g., `source`, `page_number`).
